<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://example.com/concepts/06-configuration/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Configuration - Go basic concepts</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Configuration";
        var mkdocs_page_input_path = "concepts/06-configuration.md";
        var mkdocs_page_url = "/concepts/06-configuration/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Go basic concepts
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Concepts</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../01-documentation/">Documentation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../02-makefile/">Makefile</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../03-building/">Building</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../04-routing/">Routing</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../05-logging/">Logging</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Configuration</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#basic-configuration">Basic configuration</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#clowder">Clowder</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#use-it">Use it :)</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../07-database/">Database</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../08-openapi/">OpenAPI</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../09-testing/">Testing</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Go basic concepts</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Concepts &raquo;</li>
      <li>Configuration</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="configuration-and-clowder">Configuration and clowder</h1>
<p>To customize our app across environments we need some configuration.
In addition to standard application configuration
we need to consume configuration from Red Hat Insights deployer <a href="https://github.com/RedHatInsights/clowder">clowder</a>.</p>
<h2 id="basic-configuration">Basic configuration</h2>
<p>We define structure <code>config</code> in <code>internal/config/config.go</code> to hold all our configuration variables.
We have nested structures grouping configuration variables by category.
We export these categories by referencing them by exported variables on package level <code>Category = &amp;config.Category</code>.</p>
<p>Container application configuration is mostly based on environment variables.
We want to have all our environments close.
We load all configuration from environment variables.
To configure our app locally for development and unit testing,
we will use <code>.env</code> files that stay close production setup.</p>
<p>To make this easy locally, we provide example configuration,
that can be regenerated by <code>make generate-example-config</code>.</p>
<p>To load configuration just run <code>Initialize</code> with the .env file as parameter.
In the container this file does not exist and Initialize method will load config from environment.</p>
<pre><code class="language-go">config.Initialize(&quot;config/api.env&quot;)
</code></pre>
<h2 id="clowder">Clowder</h2>
<p>We will touch Clowder more during deployments as it is mainly a deployer operator.
But as a deployer it wraps up many integrations to other services in production environments.
Most notably for now it holds configurations of Database and Cloudwatch.
Clowder adds these in a file in a container layer.
There is a <a href="https://github.com/redhatinsights/app-common-go">shared ConsoleDot library</a>
that loads this file for you and parses the config into go struct.</p>
<p>Following snippet overrides Database and Cloudwatch config with Clowder provided config.</p>
<pre><code class="language-go">import clowder &quot;github.com/redhatinsights/app-common-go/pkg/api/v1&quot;

if clowder.IsClowderEnabled() {
    cfg := clowder.LoadedConfig

    // database
    config.Database.Host = cfg.Database.Hostname
    config.Database.Port = uint16(cfg.Database.Port)
    config.Database.User = cfg.Database.Username
    config.Database.Password = cfg.Database.Password
    config.Database.Name = cfg.Database.Name

    // cloudwatch (is blank in ephemeral)
    cw := cfg.Logging.Cloudwatch
    if cw.Region != &quot;&quot; &amp;&amp; cw.AccessKeyId != &quot;&quot; &amp;&amp; cw.SecretAccessKey != &quot;&quot; &amp;&amp; cw.LogGroup != &quot;&quot; {
        config.Cloudwatch.Enabled = true
        config.Cloudwatch.Key = cw.AccessKeyId
        config.Cloudwatch.Secret = cw.SecretAccessKey
        config.Cloudwatch.Region = cw.Region
        config.Cloudwatch.Group = cw.LogGroup
    }
}
</code></pre>
<h2 id="use-it">Use it :)</h2>
<p>Now the config package holds all your configuration at the fingertip.
You can access it anywhere from your app by <code>config.Category.value</code>.</p>
<p>Remember the hardcoded http port?
Now we can use <code>config.Application.Port</code> to configure it! :)</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../05-logging/" class="btn btn-neutral float-left" title="Logging"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../07-database/" class="btn btn-neutral float-right" title="Database">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../05-logging/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../07-database/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
